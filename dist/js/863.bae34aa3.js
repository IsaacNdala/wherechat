"use strict";(self["webpackChunkwherechat"]=self["webpackChunkwherechat"]||[]).push([[863],{2863:function(e,s,t){t.r(s),t.d(s,{default:function(){return $}});var a=t(3396),o=t(7139),n=t(9242);const r={id:"message-component",class:"message-component"},m={class:"message-component__nav"},_=(0,a._)("i",{class:"fi fi-rr-arrow-small-left d-flex"},null,-1),c=[_],i={class:"message-component__nav__img-container border"},l=["src"],g={class:"message-component__nav__username"},d={class:"message-component__message-form-container"},u={class:"d-flex"},h=(0,a._)("button",{class:"btn btn-primary"},[(0,a._)("i",{class:"fi fi-rr-paper-plane d-flex"})],-1),p={class:"message-component__body"},f={class:"message-component__body__head"},v=["src"],w={class:"message-component__body__head__info"},y={class:"message-component__body__head__info__username"},b={key:0,class:"message-component__body__message__img-container border"},C=["src"];function D(e,s,t,_,D,k){return(0,a.wg)(),(0,a.iD)("div",r,[(0,a._)("nav",m,[(0,a._)("a",{onClick:s[0]||(s[0]=e=>this.$router.go(-1))},c),(0,a._)("div",i,[(0,a._)("img",{src:e.serverDomain+D.userInChat.imageUrl,alt:""},null,8,l)]),(0,a._)("span",g,(0,o.zw)(D.userInChat.firstName)+" "+(0,o.zw)(D.userInChat.lastName),1)]),(0,a._)("div",d,[(0,a._)("form",{onSubmit:s[3]||(s[3]=(0,n.iM)(((...e)=>k.sendMessage&&k.sendMessage(...e)),["prevent"]))},[(0,a._)("div",u,[(0,a.wy)((0,a._)("textarea",{"onUpdate:modelValue":s[1]||(s[1]=e=>D.messageForm.content=e),class:"form-control",placeholder:"Write a message",rows:"1"},null,512),[[n.nr,D.messageForm.content]]),(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>D.messageForm.to=e),type:"hidden"},null,512),[[n.nr,D.messageForm.to]]),h])],32)]),(0,a._)("div",p,[(0,a._)("div",f,[(0,a._)("div",{onClick:s[4]||(s[4]=(...e)=>k.scrollBottom&&k.scrollBottom(...e)),class:"message-component__body__head__img-container border"},[(0,a._)("img",{src:e.serverDomain+D.userInChat.imageUrl,alt:""},null,8,v)]),(0,a._)("div",w,[(0,a._)("span",y,(0,o.zw)(D.userInChat.firstName)+" "+(0,o.zw)(D.userInChat.lastName),1)])]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(k.newMessages,(s=>((0,a.wg)(),(0,a.iD)("div",{key:s._id,class:"message-component__body__message"},[(0,a._)("div",{class:(0,o.C_)(["d-flex",{"flex-row-reverse":s.me}])},[s.me?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",b,[(0,a._)("img",{src:e.serverDomain+s.imageUrl,alt:""},null,8,C)])),(0,a._)("div",{class:(0,o.C_)(["message-component__body__message__content",{"message-component__body__message__content__you":s.me}])},(0,o.zw)(s.content),3)],2),(0,a._)("span",{class:(0,o.C_)(["message-component__body__message__date",{"message-component__body__message__date__you":s.me}])},(0,o.zw)(s.date),3)])))),128))])])}var k=t(6265),F=t.n(k),I=t(4239),U=t(2066),B=t(9749),M={name:"MessageComponent",data(){return{messages:[],messageForm:{content:"",to:this.$route.params.userId},userInChat:{}}},computed:{...(0,B.rn)(["user","serverDomain"]),newMessages(){const e=[...this.messages];return e.forEach((e=>{e.from._id===I.Z.state.user.id&&(e.me=!0,e.imageUrl=e.from.imageUrl),e.from._id===this.messageForm.to&&(e.me=!1,e.imageUrl=e.from.imageUrl),e.date=new Date(e.createdAt).toDateString()})),e}},watch:{$route(e){this.messageForm.to=e.params.userId,this.fetchMessages()}},methods:{scrollBottom(){let e=document.getElementById("message-component");e.scrollTo(0,e.scrollHeight)},async sendMessage(){let e;""!==this.messageForm.content&&(e=await F().post(I.Z.state.serverDomain+"message/send-message",this.messageForm,{headers:{Authorization:`Bearer ${I.Z.state.token}`}})),e&&(this.messageForm.content="")},async fetchMessages(){try{const e=await F().get(I.Z.state.serverDomain+"message/view-messages/"+this.messageForm.to,{headers:{Authorization:`Bearer ${I.Z.state.token}`}});this.messages=e.data.messages,e&&this.fetchUser()}catch(e){e.response&&401===e.response.status&&this.$router.push("/login")}},async fetchUser(){try{const e=await F().get(I.Z.state.serverDomain+"user/get-user/"+this.messageForm.to,{headers:{Authorization:`Bearer ${I.Z.state.token}`}});this.userInChat=e.data.user}catch(e){e.response&&401===e.response.status&&this.$router.push("/login")}}},created(){this.fetchMessages()},mounted(){document.getElementById("message-component")&&console.log("mounted");const e=(0,U.ZP)(I.Z.state.serverDomain);e.on("messages",(e=>{"sent"===e.action&&(this.messages.push(e.message),this.scrollBottom())}))},updated(){this.scrollBottom()}},Z=t(89);const z=(0,Z.Z)(M,[["render",D]]);var $=z}}]);
//# sourceMappingURL=863.bae34aa3.js.map