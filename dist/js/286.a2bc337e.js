"use strict";(self["webpackChunkwherechat"]=self["webpackChunkwherechat"]||[]).push([[286],{8286:function(e,s,t){t.r(s),t.d(s,{default:function(){return D}});var a=t(3396),i=t(9242),n=t(7139);const o={class:"messages"},r={class:"messages__container"},m=(0,a._)("h5",{class:"messages__container__title"},"Messages",-1),d={class:"row g-2 align-items-center"},c={class:"col-md-12"},l={class:"messages__items"},g={class:"messages__items__img-container border"},_=["src"],h={class:"messages__items__caption-container"},u={class:"messages__items__caption-container__name"},f={class:"messages__items__caption-container__time"};function p(e,s,t,p,v,w){const y=(0,a.up)("top-navigation"),N=(0,a.up)("router-link"),M=(0,a.up)("router-view"),I=(0,a.up)("bottom-navigation");return(0,a.wg)(),(0,a.iD)("div",o,[(0,a.Wm)(y),(0,a._)("div",r,[m,(0,a._)("form",{onSubmit:s[2]||(s[2]=(0,i.iM)((()=>{}),["prevent"])),class:"mb-3"},[(0,a._)("div",d,[(0,a._)("div",c,[(0,a.wy)((0,a._)("input",{type:"text",id:"search",class:"form-control",placeholder:"search...","onUpdate:modelValue":s[0]||(s[0]=e=>v.searchInput=e),onKeyup:s[1]||(s[1]=(...e)=>w.searchMessages&&w.searchMessages(...e))},null,544),[[i.nr,v.searchInput]])])])],32),(0,a._)("div",l,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(w.filteredMessages,(s=>((0,a.wg)(),(0,a.j4)(N,{key:s.id,to:v.messagePath+s.id,"active-class":"active",class:"link-list"},{default:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a._)("img",{src:e.serverDomain+s.imageUrl,alt:""},null,8,_)]),(0,a._)("div",h,[(0,a._)("span",u,(0,n.zw)(s.name),1),(0,a._)("span",null,(0,n.zw)(s.content),1)]),(0,a._)("span",f,(0,n.zw)(s.date),1)])),_:2},1032,["to"])))),128))])]),(0,a.Wm)(M),(0,a.Wm)(I)])}var v=t(8515),w=t(7925),y=t(6265),N=t.n(y),M=t(4239),I=t(9749),U=t(2066),Z={name:"MessagesView",components:{BottomNavigation:v.Z,TopNavigation:w.Z},data(){return{messagePath:"/messages/",messages:[],searchInput:""}},computed:{...(0,I.rn)(["serverDomain"]),filteredMessages(){let e=[];for(let s=0;s<this.messages.length;s++){let t=this.messages[s];if(t.date=new Date(t.date).toDateString(),t.content.length>30){let e=t.content.slice(0,30),s=e.replace(/,[^a-zA-Z0-9]$/g,"");t.content=`${s}...`}e.push(t)}return e}},methods:{searchMessages(){let e,s=this.searchInput.toLowerCase(),t=document.getElementsByClassName("link-list");for(let a=0;a<t.length;a++)e=t[a].getElementsByClassName("messages__items__caption-container__name")[0],e.innerHTML.toLowerCase().includes(s)?t[a].style.display="":t[a].style.display="none"},async fetchMessages(){try{const e=await N().get(M.Z.state.serverDomain+"message/get-all-messages",{headers:{Authorization:`Bearer ${M.Z.state.token}`}}),s=[],t=M.Z.state.user;let a;for(const i of e.data.messages)i.from._id!==t.id&&-1===s.findIndex((e=>e.id===i.from._id))&&(a={id:i.from._id,imageUrl:i.from.imageUrl,content:i.content,name:i.from.firstName+" "+i.from.lastName,date:i.createdAt,viewed:i.viewed,me:!1},s.push(a)),i.to._id!==t.id&&-1===s.findIndex((e=>e.id===i.to._id))&&(a={id:i.to._id,imageUrl:i.to.imageUrl,content:i.content,name:i.to.firstName+" "+i.to.lastName,date:i.createdAt,viewed:i.viewed,me:!0},s.push(a));this.messages=s}catch(e){e.response&&401===e.response.status&&this.$router.push("/login")}},reatToChange(e){const s=M.Z.state.user;let t,a=e.message;a.from._id!==s.id&&(-1!==this.messages.findIndex((e=>e.id===a.from._id))&&this.messages.splice(this.messages.findIndex((e=>e.id===a.from._id)),1),t={id:a.from._id,imageUrl:a.from.imageUrl,content:a.content,name:a.from.firstName+" "+a.from.lastName,date:a.createdAt,viewed:a.viewed,me:!1},this.messages.unshift(t)),a.to._id!==s.id&&(-1!==this.messages.findIndex((e=>e.id===a.to._id))&&this.messages.splice(this.messages.findIndex((e=>e.id===a.to._id)),1),t={id:a.to._id,imageUrl:a.to.imageUrl,content:a.content,name:a.to.firstName+" "+a.to.lastName,date:a.createdAt,viewed:a.viewed,me:!0},this.messages.unshift(t))}},created(){this.fetchMessages()},mounted(){const e=(0,U.ZP)(M.Z.state.serverDomain);e.on("messages",(e=>{"sent"===e.action&&this.reatToChange(e)}))}},k=t(89);const C=(0,k.Z)(Z,[["render",p]]);var D=C}}]);
//# sourceMappingURL=286.a2bc337e.js.map